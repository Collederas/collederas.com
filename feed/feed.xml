<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="pretty-atom-feed.xsl" type="text/xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
  <title>Dr. Collederas</title>
  <subtitle>Anything I find interesting and useful for others to enjoy.</subtitle>
  <link href="https://collederas.com/feed/feed.xml" rel="self" />
  <link href="https://collederas.com/" />
  <updated>2025-08-13T00:00:00Z</updated>
  <id>https://collederas.com/</id>
  <author>
    <name>Fabrizio Scandola - Dr. Collederas</name>
  </author>
  <entry>
    <title>The basics to create a Procedural Spider in Unreal</title>
    <link href="https://collederas.com/blog/unreal-procedural-spider/" />
    <updated>2025-08-13T00:00:00Z</updated>
    <id>https://collederas.com/blog/unreal-procedural-spider/</id>
    <content type="html">&lt;p&gt;I always wanted to create a procedural creature of some sort. During development of One Last Toast I didn&#39;t really have the time and budget to do so. But with the game released I gave it a go.&lt;br&gt;
Here&#39;s the results:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/QFOd5L_hai-800.webp 800w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-procedural-spider/QFOd5L_hai-800.gif&quot; alt=&quot;Spidey walking around&quot; width=&quot;800&quot; height=&quot;450&quot;&gt;&lt;/picture&gt;
&lt;p&gt;How did I make it? I&#39;ll walk you through it so you can reproduce it for yourself.&lt;/p&gt;
&lt;h2 id=&quot;the-model&quot; tabindex=&quot;-1&quot;&gt;The Model &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-procedural-spider/#the-model&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I started by modeling this beauty in Blender.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/6ul_HlKij_-1777.avif 1777w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/6ul_HlKij_-1777.webp 1777w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-procedural-spider/6ul_HlKij_-1777.png&quot; alt=&quot;Spidey&quot; width=&quot;1777&quot; height=&quot;1311&quot;&gt;&lt;/picture&gt;
&lt;p&gt;I know, I should have gone to art school.&lt;br&gt;
What matters here is not really the art but the bone orientation.&lt;/p&gt;
&lt;p&gt;You need to ensure that bones have a consistent orientation (for example Z always facing up and Y facing along the bone).&lt;br&gt;
I went for a simple approach: 3 bones for each leg (2 for the joints and 1 for the foot) and 1 bone for the body/root.&lt;/p&gt;
&lt;p&gt;The feet are not skinned, they are just used as controls for the IK leg system that we will build in Control Rig.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/nOTAbEXcMl-502.webp 502w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-procedural-spider/nOTAbEXcMl-502.gif&quot; alt=&quot;Spidey weights&quot; width=&quot;502&quot; height=&quot;348&quot;&gt;&lt;/picture&gt;
&lt;p&gt;When that&#39;s ready, we can export and move to Unreal.&lt;/p&gt;
&lt;p&gt;PS: I will occasionally call this monster a &amp;quot;spider&amp;quot; even if it has only 6 legs. Let&#39;s all agree to that for simplicity.&lt;/p&gt;
&lt;div class=&quot;callout info&quot;&gt;&lt;div class=&quot;callout-title&quot;&gt;Exporting rigged meshes from Blender to Unreal&lt;/div&gt;&lt;p&gt;By default, importing from Blender to Unreal often causes the armature scaling to be messed up. You end up with bones that are 100 times smaller in Unreal, which makes the whole mesh tiny and causes animation issues.&lt;/p&gt;
&lt;p&gt;Before export in Blender:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Select armature and mesh&lt;/li&gt;
&lt;li&gt;Scale both by 100&lt;/li&gt;
&lt;li&gt;Apply scale&lt;/li&gt;
&lt;li&gt;Scale mesh by 0.10 and leave it as is&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id=&quot;how-a-procedural-walk-works&quot; tabindex=&quot;-1&quot;&gt;How A Procedural Walk Works &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-procedural-spider/#how-a-procedural-walk-works&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The core idea is to keep the legs fixed in place and only move them when the body has moved far enough to justify a replant.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/PTGXYeGAYV-800.webp 800w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-procedural-spider/PTGXYeGAYV-800.gif&quot; alt=&quot;Spidey planted&quot; width=&quot;800&quot; height=&quot;572&quot;&gt;&lt;/picture&gt;
&lt;p&gt;When a replant happens, the leg moves back to its &lt;strong&gt;Home Location&lt;/strong&gt;. This is the ideal target position that restores the natural offset from the body.&lt;br&gt;
If you modeled your spider in a neutral resting pose, you can store each leg&#39;s initial offset for this purpose.&lt;/p&gt;
&lt;p&gt;The Home Location must move and rotate with the body, so it is defined in &lt;strong&gt;World Space&lt;/strong&gt;.&lt;/p&gt;
&lt;img src=&quot;https://collederas.com/blog/unreal-procedural-spider/content/blog/unreal-procedural-spider/spidey-homeloc-visual.png&quot; alt=&quot;Home Locations are in red&quot;&gt;
&lt;p&gt;The Home Location is visualized in red in this gif.&lt;/p&gt;
&lt;div class=&quot;callout info&quot;&gt;&lt;div class=&quot;callout-title&quot;&gt;Local Space vs World Space&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Local Space&lt;/strong&gt; means positions are relative to the rig origin (skeletal mesh location). No matter where the mesh moves in the world, that point will always be (0,0,0) in Local Space.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;World Space&lt;/strong&gt; means the actual world position in the level.&lt;br&gt;
We store offsets in Local Space but calculate Home Locations in World Space.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;After showing you how to set this up concretely, we will build on this idea by also adding:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;obstacle collision detection for each leg&lt;/li&gt;
&lt;li&gt;a nice arched interpolation when stepping&lt;/li&gt;
&lt;li&gt;a tripod stepping pattern for a natural gait&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;setup-in-unreal&quot; tabindex=&quot;-1&quot;&gt;Setup in Unreal &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-procedural-spider/#setup-in-unreal&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;In Unreal, create a &lt;code&gt;Control Rig&lt;/code&gt; from the spider mesh.&lt;/p&gt;
&lt;p&gt;In the Setup function -which runs once at construction time- let&#39;s spawn controls to act as the IK effectors.&lt;br&gt;
This is also the time to store the &lt;strong&gt;Initial Leg Offsets&lt;/strong&gt; (Local Space) in one array, and the &lt;strong&gt;Current World Space Locations&lt;/strong&gt; of the legs in another. These WS locations are what we will move to control the legs.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/NN-siX16UD-1938.avif 1938w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/NN-siX16UD-1938.webp 1938w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-procedural-spider/NN-siX16UD-1938.png&quot; alt=&quot;Setup&quot; width=&quot;1938&quot; height=&quot;1198&quot;&gt;&lt;/picture&gt;
&lt;p&gt;Ignore &lt;em&gt;Tag Tripod&lt;/em&gt; and &lt;em&gt;Replant Info&lt;/em&gt; variables for now. We will come back to them later.&lt;/p&gt;
&lt;div class=&quot;callout warning&quot;&gt;&lt;div class=&quot;callout-title&quot;&gt;Array indexes&lt;/div&gt;&lt;p&gt;Keep index consistency.&lt;br&gt;
As you will see we will use a series of arrays to setup this rig. If index &lt;code&gt;i&lt;/code&gt; in one array refers to a leg, the same index in any other array must refer to that exact same leg.&lt;br&gt;
This is actually quite simple to achieve: on setup we construct a few arrays iterating over each leg. As long as we keep using these indexes for any other array we will need, all will be fine.&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&quot;calculating-home-locations&quot; tabindex=&quot;-1&quot;&gt;Calculating Home Locations &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-procedural-spider/#calculating-home-locations&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The intuition is simple: we take the current &lt;strong&gt;Initial Leg Offsets&lt;/strong&gt; (which are in Local Space) and add the body locations to them. Basically we are creating an imaginary point for each leg, which is relative to the body location and that we can use as a target for the replant.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/0VeXd4sUTE-1936.avif 1936w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/0VeXd4sUTE-1936.webp 1936w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-procedural-spider/0VeXd4sUTE-1936.png&quot; alt=&quot;Home Location calculation&quot; width=&quot;1936&quot; height=&quot;1174&quot;&gt;&lt;/picture&gt;
&lt;p&gt;This is done with a &lt;em&gt;Transform * Transform&lt;/em&gt; operation between the root and each leg. This operation applies one transform’s rotation and location to another, essentially moving the offset into world space.&lt;/p&gt;
&lt;div class=&quot;callout warning&quot;&gt;&lt;div class=&quot;callout-title&quot;&gt;World Location result&lt;/div&gt;&lt;p&gt;Notice how I do a &lt;em&gt;To World&lt;/em&gt; on the root before multiplying the transforms. This way the result will be a World Location. That&#39;s important because subsequent calculations will be based on this.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;callout info&quot;&gt;&lt;div class=&quot;callout-title&quot;&gt;Velocity?&lt;/div&gt;&lt;p&gt;In my version I also account for velocity (which I feed into the rig from the Animation BP) to handle sudden direction changes from AI movement. This is optional and frankly should be done better than just using an arbitrary magnitude of &amp;quot;50&amp;quot;. So please ignore that :)&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&quot;step-condition-and-replant-trigger&quot; tabindex=&quot;-1&quot;&gt;Step Condition and Replant Trigger &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-procedural-spider/#step-condition-and-replant-trigger&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;With both the current Leg Worls Space Locations and the Home Location calculated, the step trigger is simple:&lt;br&gt;
If the distance between the two is greater than a threshold, start a replant.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/f2SVwnBZAr-1158.avif 1158w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/f2SVwnBZAr-1158.webp 1158w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-procedural-spider/f2SVwnBZAr-1158.png&quot; alt=&quot;Step condition&quot; width=&quot;1158&quot; height=&quot;723&quot;&gt;&lt;/picture&gt;
&lt;h2 id=&quot;arched-step-interpolation&quot; tabindex=&quot;-1&quot;&gt;Arched Step Interpolation &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-procedural-spider/#arched-step-interpolation&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;When a replant is triggered, we do not instantly snap the leg to the Home Location.&lt;br&gt;
Instead, we interpolate from the current position to the Home Location, adding an arched Z movement for realism.&lt;/p&gt;
&lt;p&gt;I store replant data in a struct array containing the start location and destination (both in World Space). This makes the graph cleaner.&lt;br&gt;
We first decide which legs need replanting, then run a separate function to handle the interpolation.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/BB18493jtq-1686.avif 1686w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/BB18493jtq-1686.webp 1686w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-procedural-spider/BB18493jtq-1686.png&quot; alt=&quot;Replant decided&quot; width=&quot;1686&quot; height=&quot;810&quot;&gt;&lt;/picture&gt;
&lt;p&gt;During interpolation, X and Y use a standard Interpolate node, while Z uses a curve remapped so that the maximum value is the apex of the arch.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/qNg6PKrt_A-1237.avif 1237w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/qNg6PKrt_A-1237.webp 1237w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-procedural-spider/qNg6PKrt_A-1237.png&quot; alt=&quot;Replant arch&quot; width=&quot;1237&quot; height=&quot;1081&quot;&gt;&lt;/picture&gt;
&lt;p&gt;When the distance between the current location and the Home Location is nearly zero, the replant is considered complete.&lt;/p&gt;
&lt;h2 id=&quot;tripod-stepping&quot; tabindex=&quot;-1&quot;&gt;Tripod Stepping &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-procedural-spider/#tripod-stepping&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;At this point, all legs trigger a replant at about the same time if the &amp;quot;spider&amp;quot; is moving in a straight line. This results in a very unnatural motion. Insects (and any other animal with more than a few legs) tend to move in a gaited pattern. It&#39;s a &lt;a href=&quot;https://hexapodrobots.weebly.com/insect-walking-mechanisms.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;whole world you can get lost into&lt;/a&gt; but the gist of it is that legs move in groups to guarantee maximum stability: when one group moves, the other stays planted.&lt;/p&gt;
&lt;p&gt;For a 6 legged creature we will group them into two tripods:&lt;/p&gt;
&lt;p&gt;Tripod 1:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;front right leg&lt;/li&gt;
&lt;li&gt;back right leg&lt;/li&gt;
&lt;li&gt;central left leg&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Tripod 2:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;front left leg&lt;/li&gt;
&lt;li&gt;back left leg&lt;/li&gt;
&lt;li&gt;central right leg&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Only one tripod is allowed to replant at a time. We alternate between them.&lt;/p&gt;
&lt;p&gt;In Setup, assign each leg to a tripod.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/JkIN6734My-1824.avif 1824w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/JkIN6734My-1824.webp 1824w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-procedural-spider/JkIN6734My-1824.png&quot; alt=&quot;Tagging the tripods&quot; width=&quot;1824&quot; height=&quot;1413&quot;&gt;&lt;/picture&gt;
&lt;p&gt;A variable called &lt;em&gt;Current Swing Tripod&lt;/em&gt; tracks which tripod is currently allowed to replant.&lt;br&gt;
When a replant finishes, switch to the other tripod.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/eRI8GctE-w-1455.avif 1455w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/eRI8GctE-w-1455.webp 1455w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-procedural-spider/eRI8GctE-w-1455.png&quot; alt=&quot;Switch tripods&quot; width=&quot;1455&quot; height=&quot;1135&quot;&gt;&lt;/picture&gt;
&lt;h2 id=&quot;applying-ik&quot; tabindex=&quot;-1&quot;&gt;Applying IK &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-procedural-spider/#applying-ik&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The last step is to setup the IK for the legs.&lt;br&gt;
This is very simple, the only care is to use the world space target positions we calculated earlier as the Effector Transform for the IK. This way we will effectively use our calculations to determine the end location of each foot.&lt;/p&gt;
&lt;p&gt;If you are using 2 leg bones per leg, a &lt;code&gt;BASIC IK&lt;/code&gt; node will work. Otherwise, use &lt;code&gt;FABRIK&lt;/code&gt; for a 3+ bone setup.&lt;br&gt;
Use the &lt;strong&gt;Current World Space Location&lt;/strong&gt; array as the Effector Transform for each leg.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/AI2cFBT3ny-1852.avif 1852w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/AI2cFBT3ny-1852.webp 1852w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-procedural-spider/AI2cFBT3ny-1852.png&quot; alt=&quot;Legs IK&quot; width=&quot;1852&quot; height=&quot;1108&quot;&gt;&lt;/picture&gt;
&lt;p&gt;IK should be the final step in the solver. To keep things tidy, run it after all logic using a Sequence node.&lt;/p&gt;
&lt;h2 id=&quot;obstacle-detection&quot; tabindex=&quot;-1&quot;&gt;Obstacle Detection &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-procedural-spider/#obstacle-detection&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Finally, to handle uneven terrain, cast a ray straight down from above each leg location. If a hit is found, adjust the vertical position accordingly before IK.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/Wcse7nNMXT-1918.avif 1918w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-procedural-spider/Wcse7nNMXT-1918.webp 1918w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-procedural-spider/Wcse7nNMXT-1918.png&quot; alt=&quot;Obstacle detection&quot; width=&quot;1918&quot; height=&quot;501&quot;&gt;&lt;/picture&gt;
&lt;p&gt;You can interpolate this adjustment for smoother results.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;The amount of improvements you can add to this are endless but what we built up to here should already give you a solid base to start off of.&lt;br&gt;
If you run into any issue with this you are welcome to let me know in a comment, I will try to help out where possible!&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Stop fighting Unreal AI Perception System</title>
    <link href="https://collederas.com/blog/unreal-action-ai/" />
    <updated>2025-08-01T00:00:00Z</updated>
    <id>https://collederas.com/blog/unreal-action-ai/</id>
    <content type="html">&lt;p&gt;Building a working AI in Unreal should be easy, especially when all you want is something to patrol, investigate noises, and chase players. But if you’ve used Unreal&#39;s AI Perception system, you already know: it’s not as intuitive as it looks.&lt;/p&gt;
&lt;p&gt;In this post, I’ll walk through how I got a simple, reliable state-based AI working using State Trees, and how to avoid the common traps with AI Perception that ate days of my time.&lt;/p&gt;
&lt;p&gt;Individually, each of these states is easy enough to set up. The problem is switching between them at the right time in a way that is functional to the gameplay.&lt;/p&gt;
&lt;p&gt;I believe partly it’s due to the &lt;strong&gt;Unreal AI Perception system&lt;/strong&gt; being a bit cryptic and counterintuitive. And partly, because I didn’t fully understand the tools and was trying to create transitions the wrong way.&lt;/p&gt;
&lt;p&gt;Eventually, I figured out a decent way to go about it. Let me share a few ideas here.&lt;/p&gt;
&lt;h2 id=&quot;what-i-want-to-build&quot; tabindex=&quot;-1&quot;&gt;What I Want to Build &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-action-ai/#what-i-want-to-build&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;As said, at its core, I want an agent that can switch between 3 states:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Default&lt;/strong&gt;: when the agent has no task. this can be used for example to patrol but also staying idle.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Investigate&lt;/strong&gt;: move to last heard location.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Chase&lt;/strong&gt;: follow player and/or attack.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The general idea is summed up in this graph:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/v7xsKzBU6c-2031.avif 2031w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/v7xsKzBU6c-2031.webp 2031w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/v7xsKzBU6c-2031.png&quot; alt=&quot;The system I want to build&quot; width=&quot;2031&quot; height=&quot;1224&quot;&gt;&lt;/picture&gt;
&lt;p&gt;It is basically composed of 2 parts:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the state machine handling the transitions&lt;/li&gt;
&lt;li&gt;a task (which I called &lt;em&gt;UPDATE TASK&lt;/em&gt; in the picture above), running alongside it, responsible to update all the variables that are required for the state machine transitions.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let’s break it down.&lt;/p&gt;
&lt;h2 id=&quot;transition-rules&quot; tabindex=&quot;-1&quot;&gt;Transition Rules &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-action-ai/#transition-rules&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Looking at the transitions we have:&lt;/p&gt;
&lt;p&gt;Default     → Investigate  | Heard a sound&lt;br&gt;
Investigate → Chase        | Target acquired&lt;br&gt;
Chase       → Investigate  | Lost sight of target for X seconds&lt;br&gt;
Investigate → Default      | Target not reacquired&lt;/p&gt;
&lt;p&gt;All of them are based on &lt;strong&gt;Perception&lt;/strong&gt; updates: either hearing or sight. So that is the main system we&#39;ll be dealing with. Unfortunately -and here comes the tricky part- we don&#39;t really get events from the Unreal Perception System as we would intuitively want them.&lt;/p&gt;
&lt;h2 id=&quot;ai-perception-refresher&quot; tabindex=&quot;-1&quot;&gt;AI Perception refresher &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-action-ai/#ai-perception-refresher&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Since this system is likely one of the biggest hurdles for newcomers trying to build their simple AI, a little refresher is in order.&lt;/p&gt;
&lt;p&gt;The system works by assigning an &lt;em&gt;AI Perception Component&lt;/em&gt; to the agent&#39;s &lt;em&gt;AI Controller&lt;/em&gt; and configuring which senses we want to be active.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/VetUnjn5Jm-946.avif 946w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/VetUnjn5Jm-946.webp 946w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/VetUnjn5Jm-946.png&quot; alt=&quot;Senses config in AI Perception Component&quot; width=&quot;946&quot; height=&quot;1153&quot;&gt;&lt;/picture&gt;
&lt;p&gt;The component offers a delegate that can be bound to receive informations every time a new target is perceived with one of the configured senses.&lt;/p&gt;
&lt;p&gt;It offers a public, blueprint exposed, API with the following functions:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/O9iiU-eP87-883.avif 883w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/O9iiU-eP87-883.webp 883w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/O9iiU-eP87-883.png&quot; alt=&quot;The public Blueprint API of the system&quot; width=&quot;883&quot; height=&quot;678&quot;&gt;&lt;/picture&gt;
&lt;p&gt;and the following delegates that can be bound to:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/achbvPXvHt-994.avif 994w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/achbvPXvHt-994.webp 994w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/achbvPXvHt-994.png&quot; alt=&quot;The delegates of the system&quot; width=&quot;994&quot; height=&quot;654&quot;&gt;&lt;/picture&gt;
&lt;p&gt;Now let&#39;s think of the logic we are trying to build. For the simple cases where we just need to know whether a target is in sight or a sound has been heard there&#39;s no major problems. But let&#39;s consider the CHASE-&amp;gt;INVESTIGATE case. We want to be notified when the Agent has lost track of the target -when the sight sense has expired-. How would you go about that?&lt;/p&gt;
&lt;p&gt;You might look at the senses config above and notice that it allows you to configure a &lt;code&gt;Max Age&lt;/code&gt;: that is the amount of time a sense is kept into active memory before being discarded. Perfect! We can use this to forget the Sight sense after X seconds!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Wrong.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Or better, that is exactly what this setting does. But not as you might intuitively think. Let me elaborate.&lt;br&gt;
There are -I believe- 2 ways you could think of going about it. And both have gotchas:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Using the payload of the &lt;code&gt;OnPerceptionInfoUpdated&lt;/code&gt; event&lt;/li&gt;
&lt;li&gt;Using the &lt;code&gt;OnTargetPerceptionForgotten&lt;/code&gt; event&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;why-you-will-use-onperceptioninfoupdated-wrong&quot; tabindex=&quot;-1&quot;&gt;Why you will use OnPerceptionInfoUpdated wrong &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-action-ai/#why-you-will-use-onperceptioninfoupdated-wrong&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;This is the event with its payload:&lt;br&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/PeEfRYJvgO-601.avif 601w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/PeEfRYJvgO-601.webp 601w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/PeEfRYJvgO-601.png&quot; alt=&quot;The perception update event&quot; width=&quot;601&quot; height=&quot;535&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;You might look at it and think: since we get information on both the sense and the &lt;code&gt;Expiration Age&lt;/code&gt;, we could check if this value is greater than or equal the &lt;code&gt;Max Age&lt;/code&gt; (which you can configure in the &lt;code&gt;AIPerceptionComponent&lt;/code&gt; - see pic above) et voilà!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Wrong. Again&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;This is an &lt;em&gt;Update&lt;/em&gt; event: it fires at the exact moment a stimulus changes. That means when the target just got into sight, or just exited sight. If the event just happened, it means it had no time to tick its expiration clock yet: &lt;strong&gt;the Expiration Age in PerceptionUpdate events callbacks will always be 0&lt;/strong&gt;!&lt;/p&gt;
&lt;p&gt;Ok, but we can maybe use the &lt;code&gt;OnTargetPerceptionForgotten&lt;/code&gt; then!&lt;/p&gt;
&lt;h3 id=&quot;why-you-will-use-ontargetperceptionforgotten-wrong&quot; tabindex=&quot;-1&quot;&gt;Why you will use OnTargetPerceptionForgotten wrong &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-action-ai/#why-you-will-use-ontargetperceptionforgotten-wrong&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;First of all, to use this event you need to explicitly enable it in Project Settings.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/S9ALkuZsSR-1520.avif 1520w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/S9ALkuZsSR-1520.webp 1520w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/S9ALkuZsSR-1520.png&quot; alt=&quot;Receiving PerceptionForgotten events requires checking the related Project Settings checkbox&quot; width=&quot;1520&quot; height=&quot;306&quot;&gt;&lt;/picture&gt;
&lt;p&gt;Once you do this, you can bind to the related event. The problem is that this event is fired only when &lt;strong&gt;all&lt;/strong&gt; stimuli for a given Actor are forgotten. That is: if the agent forgets sight, but still has a hearing stimuli for the same actor, the event won&#39;t fire because technically the Agent is still aware of the target.&lt;/p&gt;
&lt;p&gt;This is a problem for us: CHASE-&amp;gt;INVESTIGATE requires that we detect when the Sight sense has expired, but not the Hearing one. On the contrary: we would like to fallback to existing hearing information for the same Actor so that we can tell the AI Agent to go investigate the last hearing stimulus.&lt;/p&gt;
&lt;p&gt;So, how do we get around all this?&lt;/p&gt;
&lt;p&gt;I propose a timer.&lt;/p&gt;
&lt;h2 id=&quot;handling-sight-stimulus&quot; tabindex=&quot;-1&quot;&gt;Handling sight stimulus &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-action-ai/#handling-sight-stimulus&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;We are going to create our own -sight-specific- aging system. It&#39;s actually very simple:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;When sight is lost, we start a &lt;strong&gt;timer&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;If the timer expires without reacquiring the target, we forget them.&lt;/li&gt;
&lt;li&gt;If the target is seen again, we &lt;strong&gt;reset the timer&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;How do we determine if sight is lost? Well, the info update comes with a &lt;em&gt;Is Successfully Sensed&lt;/em&gt; boolean that we can use for this: if &lt;code&gt;True&lt;/code&gt; the Agent just acquired line of sight (LOS), if &lt;code&gt;False&lt;/code&gt; the LOS has just been lost.&lt;/p&gt;
&lt;p&gt;The rest of the logic is very simple: register a new target when LOS is acquired -if the Agent didn&#39;t already have a valid target before- and reset the timer for the known target otherwise.&lt;br&gt;
And since we need to keep track of the last heard location too, we will override the related variable every time a hearing update comes in.&lt;/p&gt;
&lt;p&gt;Overall it will look like this:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/-ooISDzxyO-2412.avif 2412w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/-ooISDzxyO-2412.webp 2412w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/-ooISDzxyO-2412.png&quot; alt=&quot;Handling sense updates with custom aging timer for sight&quot; width=&quot;2412&quot; height=&quot;1358&quot;&gt;&lt;/picture&gt;
&lt;h2 id=&quot;implementation&quot; tabindex=&quot;-1&quot;&gt;Implementation &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-action-ai/#implementation&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;With the quirks of the perception system behind us we can translate this into practice.&lt;br&gt;
If you want to go with UE&#39;s default AI systems you have 2 choices: &lt;strong&gt;Behavior Trees&lt;/strong&gt; and &lt;strong&gt;State Trees&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;I find it easier to model this using State Trees because they are built around the concept of, well, state. They allow you to define authoritative transition logic: when this happens, go to this state.&lt;br&gt;
You can achieve the same exact thing with Behavior Trees (after all, you can use BTs as State Machines) but that is the path you take if you really want to complicate your life. Because Behavior Trees are reactive it is harder to define when and how a transition should take place.&lt;/p&gt;
&lt;p&gt;So, with State Tree we can use a &lt;strong&gt;State Tree Evaluator&lt;/strong&gt; to handle the logic that binds to the &lt;code&gt;AIPerceptionComponent&lt;/code&gt; and updates the relevant variables. We need to keep track of:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The current target&lt;/li&gt;
&lt;li&gt;The last heard location (for the purposes of this example we will only care about the last noise heard)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The Evaluator will:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Register for &lt;strong&gt;perception updates&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Track the current &lt;strong&gt;Target&lt;/strong&gt; and &lt;strong&gt;LastHeardLocation&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Send &lt;strong&gt;custom events&lt;/strong&gt; to trigger state transitions (this is what will cause the tree to switch to a new state)&lt;/li&gt;
&lt;li&gt;Start and resets the &lt;strong&gt;forget timer&lt;/strong&gt; for our custom Sight aging system&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;callout info&quot;&gt;&lt;div class=&quot;callout-title&quot;&gt;Sending events to the tree&lt;/div&gt;&lt;p&gt;You could forego the event sending part and handle the logic inside the State Tree transitions if you wanted to.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;This is the whole logic:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/rKj6K--u8s-1873.avif 1873w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/rKj6K--u8s-1873.webp 1873w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/rKj6K--u8s-1873.png&quot; alt=&quot;All the logic of the evaluator&quot; width=&quot;1873&quot; height=&quot;1047&quot;&gt;&lt;/picture&gt;
&lt;p&gt;With sight updates here:&lt;br&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/Ob0bEjK54S-1720.avif 1720w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/Ob0bEjK54S-1720.webp 1720w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/Ob0bEjK54S-1720.png&quot; alt=&quot;Handling sight stimulus&quot; width=&quot;1720&quot; height=&quot;756&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;And hearing updates here:&lt;br&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/ofPIk9JSQv-1920.avif 1920w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/ofPIk9JSQv-1920.webp 1920w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/ofPIk9JSQv-1920.png&quot; alt=&quot;Handling hearing stimulus&quot; width=&quot;1920&quot; height=&quot;618&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Notice 2 things:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The timer is stopped the moment the same target (you must check that the stimulus belongs to the same target!):&lt;/li&gt;
&lt;/ol&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/CoengIUKcO-1009.avif 1009w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/CoengIUKcO-1009.webp 1009w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/CoengIUKcO-1009.png&quot; alt=&quot;Be careful stopping the timer: do it only if you get a successful sight event for the same actor&quot; width=&quot;1009&quot; height=&quot;484&quot;&gt;&lt;/picture&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;The event to clear the target when the timer expires also updates the tree with an event. If you were to use transition logic, you&#39;d have to monitor the &lt;code&gt;Current Target&lt;/code&gt; variable on tick in the transition instead.&lt;/li&gt;
&lt;/ol&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/W8o-mKBk4I-790.avif 790w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/W8o-mKBk4I-790.webp 790w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/W8o-mKBk4I-790.png&quot; alt=&quot;When timer is up, clear the target and inform the tree&quot; width=&quot;790&quot; height=&quot;418&quot;&gt;&lt;/picture&gt;
&lt;p&gt;I am using another event here to inform the tree that the target is lost and a transition is required.&lt;/p&gt;
&lt;p&gt;The key here is in how to setup transitions. In particular we want to be sure that from any state we can go to Chase the moment the Agent catches sight of the target. That is why we put this transition on Root:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/OfmOS-ZhAS-1642.avif 1642w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/OfmOS-ZhAS-1642.webp 1642w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/OfmOS-ZhAS-1642.png&quot; alt=&quot;Transition to chase the moment a target is acquired&quot; width=&quot;1642&quot; height=&quot;555&quot;&gt;&lt;/picture&gt;
&lt;p&gt;Then, in order:&lt;/p&gt;
&lt;p&gt;From Chase, we go to investigate if the &lt;em&gt;Evaluator&lt;/em&gt; tells us that we lost track of the target for long enough; and we transition to Root otherwise (that is basically when the Agent -for any reason- cannot reach the target).&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/dW0WF40Zev-637.avif 637w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/dW0WF40Zev-637.webp 637w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/dW0WF40Zev-637.png&quot; alt=&quot;Chase transitions&quot; width=&quot;637&quot; height=&quot;109&quot;&gt;&lt;/picture&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/sHMUpWx_2f-1633.avif 1633w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/sHMUpWx_2f-1633.webp 1633w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/sHMUpWx_2f-1633.png&quot; alt=&quot;Chase transitions detail&quot; width=&quot;1633&quot; height=&quot;604&quot;&gt;&lt;/picture&gt;
&lt;p&gt;From investigate we always go to root, whether we can investigate the last heard location or not (always have a failsafe transition if Agent cannot perform certain actions).&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/IVDbS-0YNX-877.avif 877w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/IVDbS-0YNX-877.webp 877w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/IVDbS-0YNX-877.png&quot; alt=&quot;Investigate transitions&quot; width=&quot;877&quot; height=&quot;72&quot;&gt;&lt;/picture&gt;
&lt;p&gt;Lastly, from Patrol we similarly move to root when Agent cannot find a valid patrol location, or we transition to Investigate if a sound is heard.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/ewd0xjV_tZ-2830.avif 2830w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-action-ai/ewd0xjV_tZ-2830.webp 2830w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-action-ai/ewd0xjV_tZ-2830.png&quot; alt=&quot;Patrol transitions&quot; width=&quot;2830&quot; height=&quot;657&quot;&gt;&lt;/picture&gt;
&lt;p&gt;And really, that&#39;s it.&lt;/p&gt;
&lt;p&gt;As you see, the whole thing is not hard. It just requires you to know of some quirks with the involved systems.&lt;/p&gt;
&lt;p&gt;Now, this setup won’t cover every edge case, but it gives you a robust foundation for prototyping and iterating on more complex behaviors. And once you understand how Unreal&#39;s Perception quirks work under the hood, you&#39;ll stop fighting the system and start using it.&lt;/p&gt;
&lt;div class=&quot;callout info&quot;&gt;&lt;div class=&quot;callout-title&quot;&gt;Next Steps&lt;/div&gt;&lt;p&gt;Earlier I mentioned that part of the trickery in setting up reliable AI systems is knowing the tools. In this article I mainly investigated the quirks of the AI Perception tool but how about State Trees? As said, the trick here is to understand how transitions are evaluated and when a task is considered successful or not or simply when it is &amp;quot;completed&amp;quot; (as many transions rely on this).&lt;/p&gt;
&lt;p&gt;I might do another article about this if anyone requests it, but a good way to make sure you understand this is practice really. I&#39;ll give you a suggestion on how to train this if you want:&lt;br&gt;
The setup I explained in the post doesn&#39;t take into account the case where the target suddenly -while being chased- moves out of the navmesh (eg. climbs up a ladder).&lt;/p&gt;
&lt;p&gt;How do you update this tree in a way that will take that into account and will resume the chase as soon as the target becomes &lt;em&gt;chaseable&lt;/em&gt; again?&lt;/p&gt;
&lt;/div&gt;</content>
  </entry>
  <entry>
    <title>Profiling a case of object leak in Unreal</title>
    <link href="https://collederas.com/blog/unreal-profile/" />
    <updated>2025-05-14T00:00:00Z</updated>
    <id>https://collederas.com/blog/unreal-profile/</id>
    <content type="html">&lt;p&gt;I have recently opened up my upcoming game (&lt;a href=&quot;https://store.steampowered.com/app/3639210/One_Last_Toast/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&amp;quot;One Last Toast&amp;quot;&lt;/a&gt;) for a closed beta test among friends.&lt;/p&gt;
&lt;p&gt;Among a plethora of other bugs they reported, one stood more ominous than the rest:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-profile/p9bPe3oSI0-993.avif 993w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-profile/p9bPe3oSI0-993.webp 993w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-profile/p9bPe3oSI0-993.jpeg&quot; alt=&quot;Stop spawning stuff!&quot; width=&quot;993&quot; height=&quot;206&quot;&gt;&lt;/picture&gt;
&lt;p&gt;The reports had this happen midway through a playthrough.&lt;/p&gt;
&lt;p&gt;At a quick glance the issue is clear: too many UObjects (Unreal&#39;s own object base class) are being spawned in the game, they are piling up and, when they reach a safeguard limit, the engine shuts down to prevent the leak from eating up more resources.&lt;/p&gt;
&lt;p&gt;Great.&lt;/p&gt;
&lt;p&gt;Now, who is the culprit?&lt;/p&gt;
&lt;p&gt;That is the harder question. Profiling tools to the rescue!&lt;/p&gt;
&lt;h2 id=&quot;profiling-for-object-leaks&quot; tabindex=&quot;-1&quot;&gt;Profiling for object leaks &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-profile/#profiling-for-object-leaks&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The first thing I did was starting UnrealInsights.exe with relevant arguments to display memory and uobject-related data (&lt;code&gt;memory,object&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;I targeted the same build my friends were playtesting and... I started playing the game. In order to focus on the specific problem at hand I used the handy LLM tags to display only UObject allocations and deallocations events.&lt;/p&gt;
&lt;p&gt;After about 6 minutes of playing, I started seeing some clear and steady increase in the allocation count:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-profile/LcWltFEzjx-3486.avif 3486w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-profile/LcWltFEzjx-3486.webp 3486w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-profile/LcWltFEzjx-3486.png&quot; alt=&quot;That&#39;s no good&quot; width=&quot;3486&quot; height=&quot;934&quot;&gt;&lt;/picture&gt;
&lt;p&gt;You can see in the graph that the number of allocated objects keeps increasing and the Garbage Collector just can&#39;t keep up the pace.&lt;/p&gt;
&lt;p&gt;That is a good start. The next challenge is trying to figure out what could be causing the issue. I didn&#39;t immediately realised that something suspicious was going on but luckily the profiler has this concept of &amp;quot;Bookmarks&amp;quot; which are label given to specific events. Some of them are automatically assiged, like in the case of a Level Sequence playing or the Garbage Collector cleaning up some stale objects.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-profile/EDV_7Z7iFF-886.avif 886w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-profile/EDV_7Z7iFF-886.webp 886w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-profile/EDV_7Z7iFF-886.png&quot; alt=&quot;Find your bearings&quot; width=&quot;886&quot; height=&quot;88&quot;&gt;&lt;/picture&gt;
&lt;p&gt;This helped me noticing that the issue started appearing soon after the LS_Ruby sequencer played. LS_Ruby is the little cinematic playing when the player inserts the Ruby Key in the related panel as a mean to progress in the game&#39;s mansion.&lt;/p&gt;
&lt;p&gt;That gave me a significant hint as to where the problem was starting from.&lt;/p&gt;
&lt;p&gt;With this in mind, I decided to narrow down my guess even further. I fired up the editor with the same trace profile:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;start &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;C:&#92;Program Files&lt;span class=&quot;token entity&quot; title=&quot;&#92;E&quot;&gt;&#92;E&lt;/span&gt;pic Games&#92;UE_5.X&lt;span class=&quot;token entity&quot; title=&quot;&#92;E&quot;&gt;&#92;E&lt;/span&gt;ngine&#92;Binaries&#92;Win64&#92;UnrealEditor.exe&quot;&lt;/span&gt; OneLastToast.uproject &lt;span class=&quot;token parameter variable&quot;&gt;-trace&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;default,memory,object,loadtime &lt;span class=&quot;token parameter variable&quot;&gt;-statnamedevents&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and positioned myself straight in front of the Ruby Door.&lt;br&gt;
What happened after entering is the following:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-profile/yWb86JDVMI-540.webp 540w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-profile/yWb86JDVMI-540.gif&quot; alt=&quot;Something&#39;s afoot with this explosion&quot; width=&quot;540&quot; height=&quot;304&quot;&gt;&lt;/picture&gt;
&lt;p&gt;Look at the LLM UObject allocation graph at the bottom: sure enough something is going on with this explosion. I left the insights running and confirmed that this was not a temporary thing: the graph kept going up steadily after this event.&lt;/p&gt;
&lt;p&gt;I started looking for spawning logic related to the explosion and:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-profile/_BLymqlX1U-1369.avif 1369w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-profile/_BLymqlX1U-1369.webp 1369w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-profile/_BLymqlX1U-1369.png&quot; alt=&quot;The culprit&quot; width=&quot;1369&quot; height=&quot;814&quot;&gt;&lt;/picture&gt;
&lt;p&gt;A likely culprit appeared.&lt;/p&gt;
&lt;p&gt;FS Bomb Field is an actor that i subclassed directly from an Engine example which is in charge of applying all the physics effects related to the explosion.&lt;/p&gt;
&lt;p&gt;On its own the spawning logic I have in my Blueprint is not enough to justify a memory leak but this behemot of a Bomb Field actor is doing so much and somewhere, in the logic managing the collision of the field with other actors, it is causing wild object spawning.&lt;/p&gt;
&lt;p&gt;I am actually not sure where and why this happens. The Bombfield logic is quite... intense...&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-profile/-z-c6s6Ycs-3511.avif 3511w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-profile/-z-c6s6Ycs-3511.webp 3511w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-profile/-z-c6s6Ycs-3511.png&quot; alt=&quot;Bombfield madness&quot; width=&quot;3511&quot; height=&quot;970&quot;&gt;&lt;/picture&gt;
&lt;p&gt;And this is not even all the graph. I tried to look for spawning inducing logic in this madness but could not really find it.&lt;/p&gt;
&lt;p&gt;What I do know is:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;There is a clear memory leak&lt;/li&gt;
&lt;li&gt;The leak start to happen right after the enemy explodes (I tried the same enemy exploding on an empty map and the same pattern appeared)&lt;/li&gt;
&lt;li&gt;The bombfield is a big Blueprint with lots of collision spheres and logic&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This was enough to prompt me to ensure the field is cleaned up after the explosion to see if removing it from the world, alongside its cumbersome footprint, would help. I did set a lifetime for it here:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-profile/yZr1gFTaIV-944.avif 944w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-profile/yZr1gFTaIV-944.webp 944w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-profile/yZr1gFTaIV-944.png&quot; alt=&quot;Destroy the field after 2 seconds!&quot; width=&quot;944&quot; height=&quot;291&quot;&gt;&lt;/picture&gt;
&lt;p&gt;So that after 2 seconds (enough for the explosion forces to push nearby bodies away) the actor is destroyed and look at that:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-profile/xpe8YcBZnh-540.webp 540w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-profile/xpe8YcBZnh-540.gif&quot; alt=&quot;No more leaks upon explosion&quot; width=&quot;540&quot; height=&quot;304&quot;&gt;&lt;/picture&gt;
&lt;p&gt;No more sudden increase of UObject allocation after the explosion! I let the thing run for a while just to be sure but all seems good now.&lt;/p&gt;
&lt;p&gt;Will this fix the original crash definitively? I hope! But I can&#39;t really guarantee that there aren&#39;t other possible causes yet.&lt;/p&gt;
&lt;p&gt;For sure this was a very nasty leak that is now patched for good.&lt;/p&gt;
&lt;p&gt;I&#39;ll be sure to update the post should I gain more insights on why the bomb field is causing uncontrolled UObject spawning and if this fix was enough to guarantee a crash free experience for the testers.&lt;/p&gt;
&lt;p&gt;For now, I am quite happy with what I managed to do on my first proper use of Unreal Isights and hope this little adventure could be helpful for anyone dealing with apparently hard-to-pinpoint bugs.&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>I released a semi-automation tool for Unreal</title>
    <link href="https://collederas.com/blog/build-bridge/" />
    <updated>2025-04-14T00:00:00Z</updated>
    <id>https://collederas.com/blog/build-bridge/</id>
    <content type="html">&lt;h2 id=&quot;a-lightweight-tool-to-build-and-publish-my-game-to-itch-and-steam&quot; tabindex=&quot;-1&quot;&gt;A lightweight tool to Build and Publish my Game to Itch and Steam &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/build-bridge/#a-lightweight-tool-to-build-and-publish-my-game-to-itch-and-steam&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I am currently playtesting my upcoming game -One Last Toast- and in this phase I need to iterate quickly: make a build, deploy, fix bugs, make another build.&lt;/p&gt;
&lt;p&gt;Now, I am alone and have no fancy studio with proper CI/CD pipelines set up, so I was doing all of this manually.&lt;/p&gt;
&lt;p&gt;Then one afternoon I decided that, while proper automation is probably overkill, having some sort of tool to make the process smoother would be nice.&lt;/p&gt;
&lt;h2 id=&quot;the-app&quot; tabindex=&quot;-1&quot;&gt;The App &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/build-bridge/#the-app&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;With this tool I wanted to achieve 2 things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Have a structured system to keep all builds in one folder, organized by version number&lt;/li&gt;
&lt;li&gt;Deploy to platforms using a few clicks&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For this, I came up with the following UI:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/build-bridge/yw3q2-kOHk-1063.avif 1063w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/build-bridge/yw3q2-kOHk-1063.webp 1063w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/build-bridge/yw3q2-kOHk-1063.png&quot; alt=&quot;Main UI&quot; width=&quot;1063&quot; height=&quot;809&quot;&gt;&lt;/picture&gt;
&lt;p&gt;Two sections. The top one solves problem 1, the bottom one solves problem 2.&lt;/p&gt;
&lt;h2 id=&quot;building&quot; tabindex=&quot;-1&quot;&gt;Building &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/build-bridge/#building&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;You start by creating a &lt;strong&gt;Build Target&lt;/strong&gt;, which is a configuration that saves your build preferences.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/build-bridge/Jx9oDjGaPi-1201.avif 1201w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/build-bridge/Jx9oDjGaPi-1201.webp 1201w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/build-bridge/Jx9oDjGaPi-1201.png&quot; alt=&quot;Build Target&quot; width=&quot;1201&quot; height=&quot;807&quot;&gt;&lt;/picture&gt;
&lt;p&gt;With that information, the Builder will use the &lt;code&gt;RunUAT&lt;/code&gt; batch file in the Engine (yes, you need Unreal installed, but if you are using this tool then that’s a safe assumption for me) to build the project, and it will store it in the directory you configured in the Project settings.&lt;/p&gt;
&lt;p&gt;You will be required to enter a version number in order to build, as you can see from the main interface. So builds will be located at:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;ProjectName
	&lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;_ BuildVersion &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;eg. v0.1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;_ Windows
	&lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;_ BuildVersion &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;eg. v0.2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;publishing&quot; tabindex=&quot;-1&quot;&gt;Publishing &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/build-bridge/#publishing&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The bottom part solves issue number 2: once I make a build I usually need to go get the right tool to publish the update. That would be:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;butler&lt;/code&gt;, for Itch&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SteamCMD&lt;/code&gt;, for Steam&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Also, for Steam, I need to make sure that the &lt;code&gt;contentroot&lt;/code&gt; value is correctly set in the &lt;code&gt;.vdf&lt;/code&gt; file (not to mention you need to create a &lt;code&gt;.vdf&lt;/code&gt; file the first time you publish).&lt;/p&gt;
&lt;p&gt;So I automated all of that. The app stores your publishing preferences under a &lt;strong&gt;Publish Profile&lt;/strong&gt;.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/build-bridge/DOR5J1B7lJ-987.avif 987w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/build-bridge/DOR5J1B7lJ-987.webp 987w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/build-bridge/DOR5J1B7lJ-987.png&quot; alt=&quot;Publishing&quot; width=&quot;987&quot; height=&quot;802&quot;&gt;&lt;/picture&gt;
&lt;p&gt;I configure this once and then they are saved for each subsequent build. So then publishing is just a matter of selecting the target store and pressing the “Publish” button.&lt;/p&gt;
&lt;p&gt;This launches a wrapper around the related command-line tool in a separate process and shows logs in the dialog.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/build-bridge/6fgO31nl---1053.avif 1053w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/build-bridge/6fgO31nl---1053.webp 1053w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/build-bridge/6fgO31nl---1053.png&quot; alt=&quot;Pulish Dialog in action&quot; width=&quot;1053&quot; height=&quot;799&quot;&gt;&lt;/picture&gt;
&lt;h2 id=&quot;speed-vs-quality&quot; tabindex=&quot;-1&quot;&gt;Speed vs Quality &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/build-bridge/#speed-vs-quality&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;As I was developing, I initially gave in and let LLMs do most of the work. I had a design in mind, but the implementation was left to whatever AI chatbot I felt like using at the moment.&lt;/p&gt;
&lt;p&gt;While on one hand this allowed me to have a working build quite soon — in less than a week — the time I then spent, and still have to spend, refactoring all the oddities that this caused is not negligible.&lt;/p&gt;
&lt;p&gt;Still, I find it way less stressful to have a working product that does what it needs and that I can then refactor at my convenience, than putting a lot of effort and time into trying to come up with the perfect design upfront and delaying testing the product in the field by a lot.&lt;/p&gt;
&lt;p&gt;Now, with this I am not advocating my style for everything. Every project has its own goals, and the approach varies based on those.&lt;/p&gt;
&lt;h2 id=&quot;i-released-it!&quot; tabindex=&quot;-1&quot;&gt;I Released it! &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/build-bridge/#i-released-it!&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;In the end, I have in my hands a little tool that is an in-between solution — between a total lack of automation and a full CI/CD pipeline.&lt;/p&gt;
&lt;p&gt;It forces some organization on the user, and allows publishing (albeit still manually) in a way that I find way friendlier than using a command line.&lt;/p&gt;
&lt;p&gt;So I decided to make it public.&lt;br&gt;
The binary is hosted on Itch and can be downloaded &lt;a href=&quot;https://collederas.itch.io/build-bridge&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The code is fully open source, under the Apache license, and hosted &lt;a href=&quot;https://github.com/Collederas/build-bridge&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;on GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I have just released a beta version that you can try out by downloading it from itch.&lt;br&gt;
The software is fully open source and you can check it out at &lt;a href=&quot;https://github.com/Collederas/build-bridge&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;https://github.com/Collederas/build-bridge&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I don’t know whether it currently packs enough features to appeal to a lot of developers out there, but if you are a fellow indie developer and happen to struggle with your release process — give it a try!&lt;/p&gt;
&lt;p&gt;I will base future support on my personal needs, but I’d be very happy to tailor it to other people’s use cases if anyone will have proposals.&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>How Not to Solve a Problem</title>
    <link href="https://collederas.com/blog/how-not-to-solve-problems/" />
    <updated>2025-03-24T00:00:00Z</updated>
    <id>https://collederas.com/blog/how-not-to-solve-problems/</id>
    <content type="html">&lt;h2 id=&quot;the-debugging-spiral-of-despair&quot; tabindex=&quot;-1&quot;&gt;The Debugging Spiral of Despair &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/how-not-to-solve-problems/#the-debugging-spiral-of-despair&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Picture this: You&#39;re debugging a complex piece of code that’s been trouble for hours. Your screen is filled with half-attempted fixes, each more desperate than the last. You&#39;ve stopped thinking and started clicking—trying random solutions, hoping something will magically work. Sound familiar?&lt;/p&gt;
&lt;h2 id=&quot;a-personal-wake-up-call&quot; tabindex=&quot;-1&quot;&gt;A Personal Wake-Up Call &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/how-not-to-solve-problems/#a-personal-wake-up-call&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;In a &lt;a href=&quot;https://collederas.com/blog/unreal-debug&quot;&gt;recent post&lt;/a&gt;, I explained how to debug a packaged Unreal build to investigate a peculiar crash — one with an opaque stack trace that gave little away. Before that, I was deleting areas of my map piece by piece, trying to isolate what I thought was a corrupted asset. Delete, package, test. Fail. Repeat. Mindlessly. All because I didn’t know better and didn’t want to figure out a smarter approach. Hours later, with a mess of half-deleted maps and no progress, it hit me: I was brute-forcing it.&lt;/p&gt;
&lt;h2 id=&quot;the-psychological-trap-of-unproductive-problem-solving&quot; tabindex=&quot;-1&quot;&gt;The Psychological Trap of Unproductive Problem-Solving &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/how-not-to-solve-problems/#the-psychological-trap-of-unproductive-problem-solving&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I fall into this more often than I’d like to admit. When faced with a tough problem, it feels productive to keep at it relentlessly — like I’m working hard. But I’m just spinning my wheels. I’d guess I’m not alone. It’s tempting to avoid &amp;quot;wasting time&amp;quot; thinking and instead click away stubbornly, even when it’s getting me nowhere.&lt;/p&gt;
&lt;h2 id=&quot;a-better-approach%3A-thinking-with-purpose&quot; tabindex=&quot;-1&quot;&gt;A Better Approach: Thinking with Purpose &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/how-not-to-solve-problems/#a-better-approach%3A-thinking-with-purpose&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The solution is to step back and think with purpose. Rubber ducking, anyone? At any point, you should be able to describe your problem and how your next step aims to fix it: What’s the issue? What’ve I tried? Why didn’t it work? What’s my plan now? In my case, I realized I needed more information. So I learned to breakpoint engine code in a packaged game crash. As the post shows, that led me to an old project setting I fixed in seconds.&lt;/p&gt;
&lt;h2 id=&quot;the-power-of-stepping-back&quot; tabindex=&quot;-1&quot;&gt;The Power of Stepping Back &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/how-not-to-solve-problems/#the-power-of-stepping-back&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Time is our most valuable resource—for clients, for ourselves, for our sanity. Once I stopped flailing and started thinking, I not only fixed a very nasty bug but also spared myself many more hours of frustration. A deliberate pause can outpace endless grinding.&lt;/p&gt;
&lt;p&gt;I don’t know how common this is, but I’m willing to bet I’m not alone. Save yourself. Take a breath. Think. Act with purpose. Your time’s worth it.&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>How to Debug an Unreal Engine Packaged Build</title>
    <link href="https://collederas.com/blog/unreal-debug/" />
    <updated>2025-03-23T00:00:00Z</updated>
    <id>https://collederas.com/blog/unreal-debug/</id>
    <content type="html">&lt;h1 id=&quot;context&quot; tabindex=&quot;-1&quot;&gt;Context &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-debug/#context&quot;&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Recently I had to deal with a very nasty error happening on a packaged build of my upcoming game (The Last Toast - working title).&lt;/p&gt;
&lt;p&gt;The game would exit without a useful error message, and looking at the logs, I could not find anything helpful—just a vague stack trace hinting at the issue being inside the Render Thread. Sure, but where? Why? What is the issue exactly?&lt;/p&gt;
&lt;p&gt;I figured this could be a problem for someone else as well, so here is a small guide on how to deal with such a problem.&lt;/p&gt;
&lt;p&gt;The goal is to be able to enter a breakpoint at the exact C++ line that is failing.&lt;/p&gt;
&lt;h2 id=&quot;how-to-debug-an-engine-crash-on-a-packaged-build-in-unreal&quot; tabindex=&quot;-1&quot;&gt;How to debug an Engine crash on a packaged build in Unreal &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/unreal-debug/#how-to-debug-an-engine-crash-on-a-packaged-build-in-unreal&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I want to emphasize that this guide is intended to debug an issue that comes from Engine code. If your game is crashing on game code, you likely won&#39;t need to check things down at the engine level.&lt;/p&gt;
&lt;p&gt;In order to breakpoint engine code on a running build, there are fundamentally two options:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Use debug symbols.&lt;/li&gt;
&lt;li&gt;Use a version of the engine compiled from source.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The first option is definitely easier but may not include symbols for your specific issue. I think it&#39;s still worth trying it first before resorting to building the whole engine.&lt;/p&gt;
&lt;p&gt;To enable the debug symbols, you simply need to go into the Epic Games Launcher and enable the following option (little arrow next to &amp;quot;Launch&amp;quot; -&amp;gt; Options).&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-debug/5hu6O1gXi9-966.avif 966w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-debug/5hu6O1gXi9-966.webp 966w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-debug/5hu6O1gXi9-966.png&quot; alt=&quot;Enable debug symbols.&quot; width=&quot;966&quot; height=&quot;744&quot;&gt;&lt;/picture&gt;
&lt;p&gt;Then you need to ensure you are packaging the game using the &amp;quot;Debug&amp;quot; configuration. Why Debug? Because this builds both engine and game code without optimizations; code is not altered, and memory layout is not changed.&lt;/p&gt;
&lt;p&gt;You can select the build configuration from inside the editor from the Package menu.&lt;/p&gt;
&lt;p&gt;I recommend checking out the &lt;a href=&quot;https://dev.epicgames.com/documentation/en-us/unreal-engine/build-configurations-reference-for-unreal-engine&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;documentation about this&lt;/a&gt; on the official website and/or watching &lt;a href=&quot;https://dev.epicgames.com/community/learning/tutorials/dXl5/advanced-debugging-in-unreal-engine#intro&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this video&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;According to the docs, the output build folder should include the .pdb files if built with any configuration that is not Shipping. However, in my case, the file was not generated until I enabled the relevant option in project settings by going to: Project Settings → Project → Packaging → Project → Include Debug Files in Shipping Builds. Really not sure why that is.&lt;/p&gt;
&lt;p&gt;You can easily check if your setup included the symbols file by going into your built game directory → &lt;em&gt;Project Name&lt;/em&gt; → Win64 → Binaries and checking that you have the aforementioned .pdb file next to the executable.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-debug/-evV_0W8Dk-1957.avif 1957w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-debug/-evV_0W8Dk-1957.webp 1957w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-debug/-evV_0W8Dk-1957.png&quot; alt=&quot;Include Symbols in Shipping, maybe needed.&quot; width=&quot;1957&quot; height=&quot;504&quot;&gt;&lt;/picture&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-debug/QPSC7XYf5W-1312.avif 1312w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-debug/QPSC7XYf5W-1312.webp 1312w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-debug/QPSC7XYf5W-1312.png&quot; alt=&quot;.pdb file.&quot; width=&quot;1312&quot; height=&quot;625&quot;&gt;&lt;/picture&gt;
&lt;div class=&quot;callout note&quot;&gt;&lt;div class=&quot;callout-title&quot;&gt;Windows, Mac, Linux&lt;/div&gt;&lt;p&gt;I am not sure what the folder structure and debug symbols are on Linux and macOS. Guess it&#39;s not going to be that different anyway.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Once you have this step set up, you are ready for the actual debugging. Launch Visual Studio and open a new solution. But instead of looking for a .sln file, you can now navigate to the &lt;em&gt;.exe&lt;/em&gt; inside the Binaries folder (not the one at the root!) and start it as you would for a regular configuration.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-debug/EX61WKk48I-1075.avif 1075w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-debug/EX61WKk48I-1075.webp 1075w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-debug/EX61WKk48I-1075.png&quot; alt=&quot;In VS, open your executable as a solution.&quot; width=&quot;1075&quot; height=&quot;751&quot;&gt;&lt;/picture&gt;
&lt;p&gt;Your game should launch. Now just trigger the crash and, lo and behold, you should see Visual Studio taking over with an automatic exception breakpoint right where the issue was triggered. You might even be able to inspect memory at that point.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/unreal-debug/4s74eGegYT-1240.avif 1240w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/unreal-debug/4s74eGegYT-1240.webp 1240w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/unreal-debug/4s74eGegYT-1240.png&quot; alt=&quot;Exception caught!&quot; width=&quot;1240&quot; height=&quot;463&quot;&gt;&lt;/picture&gt;
&lt;p&gt;In my case, I could see that the issue was related to the Cheat Manager loading some unreferenced CVar (I had set up some test CVar in the Project Setting some time ago and then totally forgot about it). I removed that, and all was fine.&lt;/p&gt;
&lt;p&gt;I doubt I would have ever figured this out without going through this debugging process. I hope this helps some other folks out there!&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Enjoying Gothic 1 in 2025 on a Steam Deck</title>
    <link href="https://collederas.com/blog/gothic-steamdeck/" />
    <updated>2025-03-17T00:00:00Z</updated>
    <id>https://collederas.com/blog/gothic-steamdeck/</id>
    <content type="html">&lt;p&gt;I recently had a kid, and this meant my regular work schedule got completely flipped around. As this happened, in between nappy changing, feeding, and caring for my girlfriend&#39;s recovery, I found little pockets of time—about 2–3 hours—emerging from my new schedule.&lt;/p&gt;
&lt;p&gt;That&#39;s when the Steam Deck, gifted by a dear friend and almost forgotten on a living room shelf, caught my eye.&lt;/p&gt;
&lt;p&gt;But what game to play? For some obscure reason, a perverse idea crept into my mind: I really wanted to revisit an old title that I never had the pleasure of playing—Gothic 1. I played the second and third games but never the original.&lt;/p&gt;
&lt;p&gt;The problem is, Gothic came out in 2001—way before the Steam Deck was a thing and, heck, way before console gaming was as mainstream as it is today. And Gothic was a PC-only kind of deal. No controller. Just keyboard.&lt;/p&gt;
&lt;p&gt;&amp;quot;Will I be able to make it work?&amp;quot; I thought. Turns out: yes. And better than I&#39;d hoped for. So I decided to share how.&lt;/p&gt;
&lt;h2 id=&quot;how-to-run-gothic-1-on-a-steam-deck-with-full-gamepad-support&quot; tabindex=&quot;-1&quot;&gt;How to run Gothic 1 on a Steam Deck with full Gamepad Support &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/gothic-steamdeck/#how-to-run-gothic-1-on-a-steam-deck-with-full-gamepad-support&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;So, you want to enjoy this great classic while chilling on the couch? Great. This is entirely possible, and I think you&#39;ll be pleased with the results. But it will take a little bit of effort, so get ready to get your hands dirty—figuratively. We’ve got to dig deep into the Deck&#39;s OS.&lt;/p&gt;
&lt;div class=&quot;callout note&quot;&gt;&lt;div class=&quot;callout-title&quot;&gt;Note&lt;/div&gt;&lt;p&gt;90% of &lt;strong&gt;the&lt;/strong&gt; information available here comes from various places on The Internet. I just collected all relevant bits here and gave them some structure, so praise to the original authors. Notably &lt;a href=&quot;https://www.reddit.com/r/SteamDeck/comments/uxtomx/comment/ia92wm7/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this reddit comment&lt;/a&gt; and &lt;a href=&quot;https://steamcommunity.com/workshop/filedetails/discussion/2791606767/592891465952152936/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this steam workshop discussion&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&quot;setup-the-workshop&quot; tabindex=&quot;-1&quot;&gt;Setup the Workshop &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/gothic-steamdeck/#setup-the-workshop&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;In Steam, set Gothic&#39;s beta version to &amp;quot;workshop.&amp;quot; To do this, navigate to the game settings (gear icon), select Properties, scroll down to Beta, and enable the workshop.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/gothic-steamdeck/FVGst0ZgJ4-1280.avif 1280w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/gothic-steamdeck/FVGst0ZgJ4-1280.webp 1280w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/gothic-steamdeck/FVGst0ZgJ4-1280.jpeg&quot; alt=&quot;Steam Deck Beta screen where you can enable the workshop.&quot; width=&quot;1280&quot; height=&quot;800&quot;&gt;&lt;/picture&gt;
&lt;h2 id=&quot;enable-mods&quot; tabindex=&quot;-1&quot;&gt;Enable Mods &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/gothic-steamdeck/#enable-mods&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Visit Gothic 1 workshop and subscribe to the following mods:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://steamcommunity.com/sharedfiles/filedetails/?id=2787491081&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Union - patch for Gothic 1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://steamcommunity.com/sharedfiles/filedetails/?id=2793930041&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;zGamePad - complete gamepad support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://steamcommunity.com/sharedfiles/filedetails/?id=2786936496&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Ninja&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://steamcommunity.com/sharedfiles/filedetails/?id=2789245548&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Gothic 1 Community Patch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://steamcommunity.com/sharedfiles/filedetails/?id=2791606767&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;DirectX 11 Renderer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://steamcommunity.com/sharedfiles/filedetails/?id=2813524957&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Mss32.dll - Union Linux sound fix&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;callout warning&quot;&gt;&lt;div class=&quot;callout-title&quot;&gt;Mod loading order matters!&lt;/div&gt;&lt;p&gt;The order in which these mods are loaded matters. You can let steam detect the ideal order using the option in the dropdown or order them yourself. You can see below the intended order.&lt;/p&gt;
&lt;/div&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/gothic-steamdeck/AC5NhUt6Pi-1280.avif 1280w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/gothic-steamdeck/AC5NhUt6Pi-1280.webp 1280w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/gothic-steamdeck/AC5NhUt6Pi-1280.jpeg&quot; alt=&quot;Recommended mod list.&quot; width=&quot;1280&quot; height=&quot;800&quot;&gt;&lt;/picture&gt;
&lt;h2 id=&quot;setup-the-emulator&quot; tabindex=&quot;-1&quot;&gt;Setup The Emulator &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/gothic-steamdeck/#setup-the-emulator&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Since this is an old Windows game, it requires emulation. Steam comes preloaded with some Proton versions, but to load all the mods above, we need a custom version called ProtonUp-Qt.&lt;/p&gt;
&lt;p&gt;To install this:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Switch to Desktop Mode. Press the STEAM button, go to Power, and select Switch to Desktop.&lt;/li&gt;
&lt;li&gt;Open the Terminal from the launcher (System → Terminal).&lt;/li&gt;
&lt;li&gt;Run the following commands:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ flatpak &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; net.davidotek.pupgui2
$ flatpak &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; com.github.Matoking.protontricks&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;
&lt;p&gt;Open the ProtonUp-Qt desktop app and install the latest Proton-GE version 8. (Version 9 is the latest at the time of writing, but it has issues where the game crashes on launch. If a newer version is available, it may be worth trying it.)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Before exiting Desktop Mode, open Dolphin (File Manager) and navigate to:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;~/.steam/steam/steamapps/common/Gothic/system&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here, delete &lt;em&gt;SteamPack.ini&lt;/em&gt; to allow the Union mod to generate its own replacement.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Switch back to Gaming Mode and enable the downloaded Proton-GE version from the list (likely at the bottom).&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/gothic-steamdeck/ELlz_KIeEn-1280.avif 1280w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/gothic-steamdeck/ELlz_KIeEn-1280.webp 1280w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/gothic-steamdeck/ELlz_KIeEn-1280.jpeg&quot; alt=&quot;Compatibility with Proton GE.&quot; width=&quot;1280&quot; height=&quot;800&quot;&gt;&lt;/picture&gt;
&lt;p&gt;Launch the game. You should see the Gothic Mod Launcher screen.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/gothic-steamdeck/iJ4Nx4e9B9-1280.avif 1280w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/gothic-steamdeck/iJ4Nx4e9B9-1280.webp 1280w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/gothic-steamdeck/iJ4Nx4e9B9-1280.jpeg&quot; alt=&quot;Gothic mod launcher.&quot; width=&quot;1280&quot; height=&quot;800&quot;&gt;&lt;/picture&gt;
&lt;p&gt;If you got this far—congratulations! But now, quit the game. We are not done yet; this step was just to allow the game to generate some required Proton directories.&lt;/p&gt;
&lt;h2 id=&quot;directx11-and-music-fixes&quot; tabindex=&quot;-1&quot;&gt;DirectX11 and Music Fixes &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/gothic-steamdeck/#directx11-and-music-fixes&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;If you play the game now, you’ll likely have no music and no DirectX 11 support. Let’s fix that.&lt;/p&gt;
&lt;p&gt;Switch back to Desktop Mode and launch the Terminal again:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ flatpak run com.github.Matoking.protontricks &lt;span class=&quot;token number&quot;&gt;65540&lt;/span&gt; directmusic&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;One more thing to allow this mod to work:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Open the file&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;~/.steam/steam/steamapps/compatdata/65540/pfx/user.reg&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Find the section&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[Software&#92;&#92;Wine&#92;&#92;DllOverrides]&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Add this line&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&quot;ddraw&quot;=&quot;native,builtin&quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;em&gt;(This enables the DirectX 11 renderer.)&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;
&lt;p&gt;Delete&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&quot;*dsound&quot;=&quot;native&quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;em&gt;(This fixes some minor sound delay and crackling)&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&quot;5&quot;&gt;
&lt;li&gt;Save and close&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;fix-gd3d11-crash&quot; tabindex=&quot;-1&quot;&gt;Fix GD3D11 crash &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/gothic-steamdeck/#fix-gd3d11-crash&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;At this point, the game should run fine. However, if you encounter a GD3D11 crash on launch, there’s a fix.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Launch the game and when presented with the mod screen, select GD3D11 and click on &amp;quot;Mod Files&amp;quot; at the top (you need to use the touch screen). This will open up a Windows-like filesystem browser. Note down the Location at the top (it is a big number).&lt;/li&gt;
&lt;li&gt;Switch to Desktop Mode and open Firefox.&lt;/li&gt;
&lt;li&gt;Go to the GD3D11 GitHub page.&lt;/li&gt;
&lt;li&gt;Download the 17.8-dev9 version. (You can switch tags from the dropdown at the top, next to the &amp;quot;Branches and Tags&amp;quot; indicator.)&lt;/li&gt;
&lt;li&gt;Navigate to the GD3D11 System folder you noted down earlier and delete all its content (not the System folder itself, just its content).&lt;/li&gt;
&lt;li&gt;Extract the files you downloaded from GitHub inside the now empty Systems folder.&lt;/li&gt;
&lt;li&gt;Switch back to Game Mode and launch the game.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;em&gt;Thanks to Finalzero for commenting and pointing out an issue with this procedure. In an earlier version I was wrongly suggesting to unzip the github files directly in the Gothic system folder.&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&quot;gamepad-support&quot; tabindex=&quot;-1&quot;&gt;Gamepad support &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/gothic-steamdeck/#gamepad-support&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;You’ll probably need to get used to Gothic’s old-school interaction system. &lt;a href=&quot;https://www.youtube.com/watch?v=n_vIs-kavqI&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Here&lt;/a&gt; is an explanatory video about it.&lt;br&gt;
However, you can improve the experience by activating a community controller layout. Navigate to:&lt;/p&gt;
&lt;p&gt;Controller Settings (next to Settings on the game page)→ Community Layouts.&lt;/p&gt;
&lt;p&gt;Experiment with different layouts to find the one that works best for you.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://collederas.com/blog/gothic-steamdeck/ES-NvrRiSx-1280.avif 1280w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://collederas.com/blog/gothic-steamdeck/ES-NvrRiSx-1280.webp 1280w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://collederas.com/blog/gothic-steamdeck/ES-NvrRiSx-1280.jpeg&quot; alt=&quot;Community controller layouts.&quot; width=&quot;1280&quot; height=&quot;800&quot;&gt;&lt;/picture&gt;
&lt;h2 id=&quot;enjoy!&quot; tabindex=&quot;-1&quot;&gt;Enjoy! &lt;a class=&quot;direct-link&quot; href=&quot;https://collederas.com/blog/gothic-steamdeck/#enjoy!&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;That’s it! You can now play this old classic, fully restored and with modern rendering features, on your Steam Deck. Happy gaming!&lt;/p&gt;
</content>
  </entry>
</feed>